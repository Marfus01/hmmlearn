## 初始化
开启调试模式：
```cmd
# 如果要开发，建议先fork仓库，然后克隆你的fork
git clone  https://github.com/your-username/hmmlearn.git 
cd hmmlearn

# 添加上游仓库
git remote add upstream  https://github.com/hmmlearn/hmmlearn.git 

# 开发模式安装
pip install -e .
```

经过验证，当n_trials = 1时，MultinomialHMM与CategoricalHMM等价。由于我们只会用到n_trials = 1的情况，因此后续开发将主要围绕CategoricalHMM展开。

## 加入协变量 X
引入active speaker face的识别结果作为协变量X后，说话人状态初始概率、转移概率的统计模型如下：
协变量 X 是完全可观测的，形如(n_total_samples, n_actors)的0-1 np.array，在指定时刻（也即X的指定行），如果X中某些列取值为1，则当前时刻的说话人更有可能与这些列对应。请注意，X中行、列的含义与S_hat_onehot，F_hat都是对应的。
上述直觉通过引入参数 eta1, eta2实现，具体而言 new model for $\bbeta_\omega$ and $\bA_\omega$ in \eqref{eq:SPNHMM-3} is to specify $\omega_{i,t}=F_{i,t,S_{i,t}}$ and let
\begin{align}
\label{eq:SPHMM-S|F-a}
\bbP(S_{i,1}\vert\bF_{i,1,\cdot}, X_{i,1,\cdot})
\propto& \exp\big(\beta_{S_{i,1}}+\gamma_1\cdot F_{i,1,S_{i,1}}+\eta_1\cdot X_{i,1,S_{i,1}}\big),\\
\label{eq:SPHMM-S|F-b}
\bbP(S_{i,t}\vert S_{i,t-1};\bF_{i,t,\cdot}, X_{i,t,\cdot})
\propto&\exp\big(\bA_S(S_{i,t-1},S_{i,t})+\gamma_2\cdot F_{i,t,S_{i,t}}+\eta_2\cdot X_{i,t,S_{i,t}}\big),
\end{align}
其他环节不变。上述模型对应的概率是 given F, X 下， S的条件概率，故归一化需要在给定F, X时，对 S进行。

## 运行结果示例
(pytorch) D:\wangchen\Research\tv_series_plus\hmmlearn>D:\ProgramFiles\anaconda3\envs\pytorch\python.exe d:/wangchen/Research/tv_series_plus/hmmlearn/debug/tv_data_sim.py
活跃说话人影响参数 η1 (初始): 2.5, η2 (转移): 2.5
=== 数据格式验证 ===
S_hat_onehot shape: (7200, 3) (说话人标签, one-hot)
F_hat shape: (7200, 3) (面部出现)
X_onehot shape: (7200, 3) (协变量)
lengths: [150, 200, 120, 250, 180, 150, 200, 120, 250, 180, 150, 200, 120, 250, 180, 150, 200, 120, 250, 180, 150, 200, 120, 250, 180, 150, 200, 120, 250, 180, 150, 200, 120, 250, 180, 150, 200, 120, 250, 180]

=== 协变量X与真实说话人的关系分析 ===
演员 0:
  X=1 时是说话人的比例: 0.824
  X=0 时是说话人的比例: 0.295
演员 1:
  X=1 时是说话人的比例: 0.886
  X=0 时是说话人的比例: 0.361
演员 2:
  X=1 时是说话人的比例: 0.793
  X=0 时是说话人的比例: 0.237

=== 使用模型: NestedHMM ===

=== 训练模型 ===
训练开始时间: 2025-10-24 15:06:08
         1  -25222.22297753             +nan
         2  -21855.23306598   +3366.98991155
         3  -21815.08661553     +40.14645045
         4  -21773.39917533     +41.68744020
         5  -21727.47572500     +45.92345032
         6  -21674.87552595     +52.60019906
         7  -21617.29666327     +57.57886268
         8  -21562.56830576     +54.72835751
         9  -21520.17061580     +42.39768996
        10  -21493.16926920     +27.00134660
        11  -21477.33726358     +15.83200563
        12  -21467.04788907     +10.28937450
        13  -21458.81873472      +8.22915435
        14  -21451.09427128      +7.72446344
        15  -21443.21489417      +7.87937711
        16  -21434.81043722      +8.40445695
        17  -21425.56219265      +9.24824457
        18  -21415.12758952     +10.43460313
        19  -21403.13712182     +11.99046769
        20  -21389.24701379     +13.89010803
        21  -21373.26354347     +15.98347032
        22  -21355.34787761     +17.91566586
        23  -21336.24234833     +19.10552928
        24  -21317.33116653     +18.91118180
        25  -21300.31397249     +17.01719405
        26  -21286.53686444     +13.77710805
        27  -21276.44329844     +10.09356600
        28  -21269.58358232      +6.85971612
        29  -21265.07584199      +4.50774033
        30  -21262.06905789      +3.00678410
        31  -21259.95178761      +2.11727028
        32  -21258.35250012      +1.59928749
        33  -21257.06506536      +1.28743476
        34  -21255.97869327      +1.08637209
        35  -21255.03280645      +0.94588682
        36  -21254.19240323      +0.84040323
        37  -21253.43568146      +0.75672176
        38  -21252.74790441      +0.68777706
        39  -21252.11859222      +0.62931219
        40  -21251.53976496      +0.57882725
        41  -21251.00515473      +0.53461023
        42  -21250.50969798      +0.49545675
        43  -21250.04921856      +0.46047941
        44  -21249.62021290      +0.42900566
        45  -21249.21969711      +0.40051579
        46  -21248.84488669      +0.37481042
        47  -21248.49378797      +0.35109872
        48  -21248.16442947      +0.32935850
        49  -21247.85506818      +0.30936129
        50  -21247.56415022      +0.29091796
训练结束时间: 2025-10-24 15:08:48
训练耗时: 160.2898931503296 秒

β (说话人初始偏好):
真实: [0.   0.1  0.05]
学习: [ 0.    -0.185  0.718]

A_S (说话人转移矩阵):
真实: [[ 0.   -0.35 -0.45]
 [-0.6   0.   -0.5 ]
 [-0.2  -0.3   0.  ]]
学习: [[ 0.    -0.236 -0.179]
 [-1.297  0.    -0.858]
 [-1.042 -0.354  0.   ]]

B_S (说话人识别混淆矩阵):
真实: [[0.8  0.15 0.05]
 [0.1  0.85 0.05]
 [0.1  0.1  0.8 ]]
学习: [[0.77  0.154 0.076]
 [0.2   0.677 0.123]
 [0.238 0.124 0.638]]

γ1 (面部对说话人初始影响):
真实: 1
学习: 0.867

γ2 (面部对说话人转移影响):
真实: 1
学习: 1.34

=== 计算后验概率 ===
[[1.29071840e-02 6.21794035e-02 1.77464365e-01]
 [7.54250861e-02 9.43327139e-02 2.69189504e-01]
 [1.61515458e-03 3.07255658e-02 2.19425524e-02]
 [1.20201320e-02 5.91249291e-02 4.20525919e-02]
 [6.51677854e-04 3.13978454e-03 3.54408764e-02]
 [4.60290973e-03 5.63702728e-03 6.48695971e-02]
 [1.15882656e-04 2.21233657e-03 6.24889768e-03]
 [9.15598806e-04 4.47244046e-03 1.27137880e-02]]

=== Viterbi 解码结果 ===
viterbi解码耗时: 2.0038139820098877 秒

=== 准确率分析 ===
面部状态准确率:
  观测准确率: 0.855
  Viterbi准确率: 0.850
说话人状态准确率:
  观测准确率: 0.826
  Viterbi准确率: 0.697

=== 使用模型: NestedHMM_Full ===

=== 训练模型 ===
训练开始时间: 2025-10-24 15:08:52
         1  -24438.75559870             +nan
         2  -21826.66497141   +2612.09062729
         3  -21751.96505078     +74.69992063
         4  -21710.81416597     +41.15088481
         5  -21683.29753044     +27.51663553
         6  -21660.54714112     +22.75038933
         7  -21638.97637015     +21.57077097
         8  -21616.96442683     +22.01194332
         9  -21593.84686155     +23.11756528
        10  -21569.85973238     +23.98712917
        11  -21546.19115715     +23.66857523
        12  -21524.51148191     +21.67967524
        13  -21505.96921291     +18.54226900
        14  -21490.53972680     +15.42948611
        15  -21477.32405258     +13.21567422
        16  -21465.25409484     +12.06995775
        17  -21453.50887499     +11.74521985
        18  -21441.56288610     +11.94598889
        19  -21429.08702519     +12.47586092
        20  -21415.85178178     +13.23524341
        21  -21401.67340126     +14.17838051
        22  -21386.40111003     +15.27229123
        23  -21369.93831073     +16.46279930
        24  -21352.28976096     +17.64854977
        25  -21333.61911796     +18.67064300
        26  -21314.28505289     +19.33406507
        27  -21294.81137501     +19.47367788
        28  -21275.76198183     +19.04939319
        29  -21257.54781435     +18.21416747
        30  -21240.26391682     +17.28389754
        31  -21223.66140210     +16.60251472
        32  -21207.27209862     +16.38930348
        33  -21190.60569012     +16.66640850
        34  -21173.32713362     +17.27855650
        35  -21155.37656343     +17.95057018
        36  -21137.02490486     +18.35165857
        37  -21118.82608930     +18.19881557
        38  -21101.41373461     +17.41235469
        39  -21085.23379838     +16.17993623
        40  -21070.45803879     +14.77575959
        41  -21057.10355882     +13.35447998
        42  -21045.12877541     +11.97478340
        43  -21034.49451110     +10.63426432
        44  -21025.11814151      +9.37636959
        45  -21016.79195408      +8.32618743
        46  -21009.27446420      +7.51748988
        47  -21002.39458217      +6.87988202
        48  -20996.05887079      +6.33571138
        49  -20990.22133256      +5.83753823
        50  -20984.85800142      +5.36333114
训练结束时间: 2025-10-24 15:12:50
训练耗时: 238.5954909324646 秒

β (说话人初始偏好):
真实: [0.   0.1  0.05]
学习: [ 0.    -1.569  0.271]

A_S (说话人转移矩阵):
真实: [[ 0.   -0.35 -0.45]
 [-0.6   0.   -0.5 ]
 [-0.2  -0.3   0.  ]]
学习: [[ 0.    -0.329 -0.124]
 [-1.014  0.    -0.732]
 [-0.655 -0.97   0.   ]]

B_S (说话人识别混淆矩阵):
真实: [[0.8  0.15 0.05]
 [0.1  0.85 0.05]
 [0.1  0.1  0.8 ]]
学习: [[0.86  0.113 0.028]
 [0.076 0.872 0.053]
 [0.125 0.255 0.62 ]]

γ1 (面部对说话人初始影响):
真实: 1
学习: 0.564

γ2 (面部对说话人转移影响):
真实: 1
学习: -0.176

η1 (协变量对说话人初始影响):
真实: 2.5
学习: 1.23

η2 (协变量对说话人转移影响):
真实: 2.5
学习: 2.436

=== 计算后验概率 ===
[[1.05343444e-04 3.13910205e-04 3.58370690e-03]
 [1.78433742e-04 6.33204545e-04 7.26000615e-03]
 [2.27692742e-03 5.72059082e-03 7.73149723e-02]
 [3.86646849e-03 1.15733636e-02 1.56994243e-01]
 [3.33197335e-04 1.00046800e-03 9.45730391e-03]
 [5.66392234e-04 2.02380319e-03 1.92315878e-02]
 [7.23095467e-03 1.83121543e-02 2.04851171e-01]
 [1.23268791e-02 3.71642217e-02 4.17680696e-01]]

=== Viterbi 解码结果 ===
viterbi解码耗时: 2.5021486282348633 秒

=== 准确率分析 ===
面部状态准确率:
  观测准确率: 0.855
  Viterbi准确率: 0.419
说话人状态准确率:
  观测准确率: 0.826
  Viterbi准确率: 0.808


=== 使用模型: HMM_X ===

=== 训练模型 ===
训练开始时间: 2025-10-24 15:12:56
         1   -8109.81124122             +nan
         2   -7674.49358630    +435.31765492
         3   -7609.60408100     +64.88950530
         4   -7555.57809287     +54.02598813
         5   -7510.70278526     +44.87530761
         6   -7474.37167111     +36.33111416
         7   -7445.67173935     +28.69993176
         8   -7423.25234403     +22.41939531
         9   -7405.60342513     +17.64891890
        10   -7391.33476892     +14.26865621
        11   -7379.34464968     +11.99011924
        12   -7368.86849604     +10.47615364
        13   -7359.44982478      +9.41867126
        14   -7350.87519041      +8.57463437
        15   -7343.10084994      +7.77434047
        16   -7336.18004443      +6.92080551
        17   -7330.19459052      +5.98545391
        18   -7325.19765672      +4.99693380
        19   -7321.17855102      +4.01910571
        20   -7318.05701456      +3.12153646
        21   -7315.69778515      +2.35922941
        22   -7313.94727495      +1.75051020
        23   -7312.65595751      +1.29131743
        24   -7311.69681309      +0.95914443
        25   -7310.97136152      +0.72545156
        26   -7310.40777981      +0.56358171
        27   -7309.95629031      +0.45148950
        28   -7309.58271935      +0.37357096
        29   -7309.26393935      +0.31878000
        30   -7308.98448316      +0.27945619
        31   -7308.73380562      +0.25067754
        32   -7308.50465416      +0.22915146
        33   -7308.29192734      +0.21272681
        34   -7308.09208782      +0.19983953
        35   -7307.90255282      +0.18953500
        36   -7307.72151809      +0.18103472
        37   -7307.54763515      +0.17388294
        38   -7307.37994516      +0.16768999
        39   -7307.21777099      +0.16217417
        40   -7307.06064767      +0.15712331
        41   -7306.90822827      +0.15241940
        42   -7306.76027121      +0.14795706
        43   -7306.61660659      +0.14366462
        44   -7306.47710520      +0.13950139
        45   -7306.34166405      +0.13544115
        46   -7306.21020865      +0.13145540
        47   -7306.08267819      +0.12753046
        48   -7305.95900111      +0.12367709
        49   -7305.83911782      +0.11988328
        50   -7305.72295825      +0.11615957
训练结束时间: 2025-10-24 15:14:43
训练耗时: 107.4924385547638 秒

β (说话人初始偏好):
真实: [0.   0.1  0.05]
学习: [ 0.    -1.359  0.043]

A_S (说话人转移矩阵):
真实: [[ 0.   -0.35 -0.45]
 [-0.6   0.   -0.5 ]
 [-0.2  -0.3   0.  ]]
学习: [[ 0.    -0.63  -0.609]
 [-1.007  0.    -0.758]
 [-0.35  -0.424  0.   ]]

B_S (说话人识别混淆矩阵):
真实: [[0.8  0.15 0.05]
 [0.1  0.85 0.05]
 [0.1  0.1  0.8 ]]
学习: [[0.71  0.212 0.078]
 [0.134 0.819 0.047]
 [0.142 0.164 0.694]]

η1 (协变量对说话人初始影响):
真实: 2.5
学习: 1.502

η2 (协变量对说话人转移影响):
真实: 2.5
学习: 3.47

=== 计算后验概率 ===
[0.08656872 0.0862126  0.82721867]

=== Viterbi 解码结果 ===
viterbi解码耗时: 0.5025768280029297 秒

=== 准确率统计 ===

=== 准确率分析 ===
说话人状态准确率:
  观测准确率: 0.826
  Viterbi准确率: 0.807
